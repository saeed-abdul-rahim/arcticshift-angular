<div class="container flex flex-wrap justify-center text-gray-700">
    <div class="absolute h-full w-full bg-white opacity-75 z-10 flex justify-center" *ngIf="productLoading">
        <app-spinner class="mt-56" [size]="5"></app-spinner>
    </div>
    <div class="flex flex-wrap justify-center w-screen md:w-7/12" id="productView">
        <lib-ngx-image-zoom [thumbImage]="selectedThumbnail" [fullImage]="selectedImage" [enableLens]="true"
            [circularLens]="true"></lib-ngx-image-zoom>
        <carousel class="pt-3" style="width: {{ innerWidth > 767 ? '75%' : '100%' }};" *ngIf="carouselImages.length > 0"
            [height]="144" [cellWidth]="144" [arrows]="false" [arrowsOutside]="true">
            <div class="carousel-cell" *ngFor="let img of carouselImages" (click)="setSelectedImage(img.image)">
                <img src="{{img.url}}" alt="{{img.name}}" />
            </div>
        </carousel>
    </div>
    <div class="w-screen px-2 md:w-5/12">
        <div class="text-3xl font-light py-3">
            {{ product && product.name || '' }}
        </div>
        <div class="text-2xl relative">
            <span class="align-text-top text-sm line-through text-gray-600">
                {{ strikePrice | currency: currency }}
            </span>
            <span class="" [ngClass]="strikePrice ? 'text-' + accentColor + '-500' : ''">
                {{ price | currency: currency }}
            </span>
            &nbsp;
            <span class="align-text-top rounded-lg p-1 text-gray-600 border border-gray-500 text-sm">
                -{{ discountPercentage }}%
            </span>
        </div>
        <div class="text-gray-600 font-thin pt-3" [innerHTML]="product && product.description"></div>
        <div class="pt-4">
            <div class="items-center" *ngIf="attributes">
                <div class="relative flex flex-wrap w-full py-2 max-w-full flex-grow flex-1"
                    *ngFor="let attribute of filteredAttributes; let i=index">
                    <div class="w-full md:w-4/12 m-auto font-light">{{ attribute.name }}</div>
                    <div class="w-full md:w-8/12">
                        <ng-select [searchable]="false" [clearable]="false"
                            (change)="changeAttribute(attribute.id, selectedAttribute[attribute.id])"
                            *ngIf="attribute.attributeValues && attribute.attributeValues.length > 0"
                            [(ngModel)]="selectedAttribute[attribute.id]" [items]="attribute.attributeValues"
                            bindValue="id" bindLabel="name"></ng-select>
                    </div>
                </div>
                <app-counter-input *ngIf="available" [label]="'Quantity'" [(value)]="quantity" [valueMin]="1">
                </app-counter-input>
                <div *ngIf="!available" class="danger-label">Out of stock</div>
            </div>
        </div>
        <div class="pt-4">
            <app-button *ngIf="available" (click)="addToCart()" [loading]="cartLoading"
                [success]="cartSuccess || variantInDraft"
                [fullWidth]="true" [color]="'gray'" [dark]="true"
                [label]="variantInDraft ? 'Update Bag' : 'Add to Bag'">
            </app-button>
        </div>
    </div>
    <div class="w-screen py-3 mt-12 border-t border-gray-300" *ngIf="product">
        <div class="text-3xl font-light py-3 px-2">
            Related Products
        </div>
        <div class="container mx-auto flex items-center flex-wrap pt-4 pb-12 arc-transition" *ngIf="collectionProducts && collectionProducts.length > 0">
            <app-product-card class="sm:w-6/12 md:w-3/12 cursor-pointer" *ngFor="let product of collectionProducts; trackBy: trackByFn"
                [id]="product.id" [title]="product.name" [images]="product.images" [price]="product.price"
                (click)="navigateToVariant(product.name, product.id)" [discountType]="product.valueType"
                [discountValue]="product.value"></app-product-card>
        </div>
        <div class="container mx-auto flex items-center flex-wrap pt-4 pb-12 arc-transition" *ngIf="categoryProducts && categoryProducts.length > 0">
            <app-product-card class="sm:w-6/12 md:w-3/12 cursor-pointer" *ngFor="let product of categoryProducts; trackBy: trackByFn"
                [id]="product.id" [title]="product.name" [images]="product.images" [price]="product.price"
                (click)="navigateToVariant(product.name, product.id)" [discountType]="product.valueType"
                [discountValue]="product.value"></app-product-card>
        </div>
    </div>
</div>